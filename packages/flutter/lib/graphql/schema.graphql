"""
Anti-Call Masking Platform GraphQL Schema
"""

# Scalars
scalar DateTime
scalar UUID
scalar BigInt

# Enums
enum VerificationStatus {
  PENDING
  VERIFIED
  MASKING_DETECTED
  FAILED
  TIMEOUT
}

enum AlertSeverity {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum AlertStatus {
  PENDING
  ACKNOWLEDGED
  INVESTIGATING
  RESOLVED
  FALSE_POSITIVE
}

enum TransactionStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
  REFUNDED
}

enum ListingStatus {
  DRAFT
  ACTIVE
  SOLD
  EXPIRED
  DELETED
}

# Types
type CallVerification {
  id: UUID!
  caller_number: String!
  callee_number: String!
  original_cli: String!
  detected_cli: String
  masking_detected: Boolean!
  confidence_score: Float!
  status: VerificationStatus!
  gateway_id: UUID
  gateway: Gateway
  mno: String
  verified_at: DateTime!
  created_at: DateTime!
  updated_at: DateTime!
}

type FraudAlert {
  id: UUID!
  call_verification_id: UUID
  call_verification: CallVerification
  gateway_id: UUID
  gateway: Gateway
  severity: AlertSeverity!
  alert_type: String!
  description: String!
  status: AlertStatus!
  acknowledged_at: DateTime
  acknowledged_by: UUID
  resolved_at: DateTime
  resolution: String
  created_at: DateTime!
  updated_at: DateTime!
}

type Gateway {
  id: UUID!
  name: String!
  operator: String!
  status: String!
  health_score: Float!
  last_heartbeat: DateTime
}

type RemittanceTransaction {
  id: UUID!
  sender_id: UUID!
  recipient_id: UUID!
  amount_sent: Float!
  currency_sent: String!
  amount_received: Float!
  currency_received: String!
  exchange_rate: Float!
  fee: Float!
  status: TransactionStatus!
  reference: String
  recipient: Recipient
  created_at: DateTime!
  completed_at: DateTime
}

type Recipient {
  id: UUID!
  user_id: UUID!
  first_name: String!
  last_name: String!
  phone_number: String!
  email: String
  bank_code: String!
  bank_name: String!
  account_number: String!
  account_name: String
  is_verified: Boolean!
  created_at: DateTime!
}

type ExchangeRate {
  from_currency: String!
  to_currency: String!
  rate: Float!
  fee: Float!
  fee_percent: Float!
  valid_until: DateTime!
}

type MarketplaceListing {
  id: UUID!
  seller_id: UUID!
  title: String!
  description: String!
  price: Float!
  currency: String!
  category: String!
  location: String
  images: [String!]!
  status: ListingStatus!
  views: Int!
  created_at: DateTime!
  updated_at: DateTime!
}

type User {
  id: UUID!
  email: String!
  phone_number: String
  first_name: String!
  last_name: String!
  is_verified: Boolean!
  created_at: DateTime!
}

# Queries
type Query {
  # Call Verifications
  call_verifications(
    limit: Int
    offset: Int
    masking_only: Boolean
  ): [CallVerification!]!
  
  call_verification(id: UUID!): CallVerification

  # Fraud Alerts
  fraud_alerts(
    limit: Int
    offset: Int
    status: AlertStatus
    min_severity: AlertSeverity
  ): [FraudAlert!]!
  
  fraud_alert(id: UUID!): FraudAlert
  pending_alerts_count: Int!

  # Remittance
  exchange_rate(
    from_currency: String!
    to_currency: String!
  ): ExchangeRate
  
  transactions(
    limit: Int
    offset: Int
    status: TransactionStatus
  ): [RemittanceTransaction!]!
  
  transaction(id: UUID!): RemittanceTransaction
  
  recipients(limit: Int, offset: Int): [Recipient!]!
  recipient(id: UUID!): Recipient

  # Marketplace
  listings(
    limit: Int
    offset: Int
    category: String
    search: String
  ): [MarketplaceListing!]!
  
  listing(id: UUID!): MarketplaceListing
  my_listings: [MarketplaceListing!]!

  # User
  me: User
}

# Mutations
type Mutation {
  # Call Verification
  verify_call(
    caller_number: String!
    callee_number: String!
  ): CallVerification!
  
  report_masking(
    verification_id: UUID!
    description: String!
    additional_notes: String
  ): Boolean!

  # Fraud Alerts
  acknowledge_alert(alert_id: UUID!): FraudAlert!
  resolve_alert(alert_id: UUID!, resolution: String!): FraudAlert!

  # Remittance
  initiate_remittance(
    recipient_id: UUID!
    amount_sent: Float!
    currency_sent: String!
  ): RemittanceTransaction!
  
  add_recipient(
    first_name: String!
    last_name: String!
    phone_number: String!
    bank_code: String!
    account_number: String!
  ): Recipient!
  
  verify_bank_account(
    bank_code: String!
    account_number: String!
  ): Recipient

  # Marketplace
  create_listing(
    title: String!
    description: String!
    price: Float!
    category: String!
    location: String
    images: [String!]!
  ): MarketplaceListing!
  
  update_listing(
    id: UUID!
    title: String
    description: String
    price: Float
    status: ListingStatus
  ): MarketplaceListing!
  
  delete_listing(id: UUID!): Boolean!
}

# Subscriptions
type Subscription {
  fraud_alerts: FraudAlert!
  call_verifications: CallVerification!
  transaction_updates(transaction_id: UUID!): RemittanceTransaction!
}
