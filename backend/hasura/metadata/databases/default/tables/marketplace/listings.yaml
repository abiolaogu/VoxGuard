table:
  name: listings
  schema: marketplace
configuration:
  column_config:
    id:
      custom_name: id
    title:
      custom_name: title
    description:
      custom_name: description
    slug:
      custom_name: slug
    category_id:
      custom_name: categoryId
    price:
      custom_name: price
    currency:
      custom_name: currency
    usd_price:
      custom_name: usdPrice
    is_negotiable:
      custom_name: isNegotiable
    seller_id:
      custom_name: sellerId
    seller_name:
      custom_name: sellerName
    seller_phone:
      custom_name: sellerPhone
    seller_verified:
      custom_name: sellerVerified
    state_code:
      custom_name: stateCode
    lga:
      custom_name: lga
    address:
      custom_name: address
    images:
      custom_name: images
    thumbnail_url:
      custom_name: thumbnailUrl
    video_url:
      custom_name: videoUrl
    is_diaspora_friendly:
      custom_name: isDiasporaFriendly
    accepts_usd:
      custom_name: acceptsUsd
    accepts_gbp:
      custom_name: acceptsGbp
    has_delivery:
      custom_name: hasDelivery
    delivery_fee:
      custom_name: deliveryFee
    view_count:
      custom_name: viewCount
    favorite_count:
      custom_name: favoriteCount
    inquiry_count:
      custom_name: inquiryCount
    status:
      custom_name: status
    is_featured:
      custom_name: isFeatured
    featured_until:
      custom_name: featuredUntil
    created_at:
      custom_name: createdAt
    updated_at:
      custom_name: updatedAt
    published_at:
      custom_name: publishedAt
    expires_at:
      custom_name: expiresAt
  custom_root_fields:
    delete: deleteListings
    delete_by_pk: deleteListing
    insert: insertListings
    insert_one: insertListing
    select: listings
    select_aggregate: listingsAggregate
    select_by_pk: listing
    update: updateListings
    update_by_pk: updateListing
object_relationships:
  - name: category
    using:
      foreign_key_constraint_on: category_id
  - name: seller
    using:
      foreign_key_constraint_on: seller_id
  - name: state
    using:
      manual_configuration:
        column_mapping:
          state_code: code
        remote_table:
          name: nigerian_states
          schema: reference
array_relationships:
  - name: favorites
    using:
      foreign_key_constraint_on:
        column: listing_id
        table:
          name: favorites
          schema: marketplace
  - name: inquiries
    using:
      foreign_key_constraint_on:
        column: listing_id
        table:
          name: inquiries
          schema: marketplace
computed_fields:
  - name: isFavorited
    definition:
      function:
        name: listing_is_favorited
        schema: marketplace
      session_argument: hasura_session
select_permissions:
  - role: anonymous
    permission:
      columns:
        - id
        - title
        - description
        - slug
        - categoryId
        - price
        - currency
        - usdPrice
        - isNegotiable
        - sellerName
        - sellerVerified
        - stateCode
        - lga
        - images
        - thumbnailUrl
        - videoUrl
        - isDiasporaFriendly
        - acceptsUsd
        - acceptsGbp
        - hasDelivery
        - deliveryFee
        - viewCount
        - favoriteCount
        - status
        - isFeatured
        - createdAt
        - publishedAt
      filter:
        status:
          _eq: active
  - role: user
    permission:
      columns: "*"
      filter:
        _or:
          - status:
              _eq: active
          - sellerId:
              _eq: X-Hasura-User-Id
      computed_fields:
        - isFavorited
  - role: admin
    permission:
      columns: "*"
      filter: {}
      allow_aggregations: true
insert_permissions:
  - role: user
    permission:
      columns:
        - title
        - description
        - categoryId
        - price
        - currency
        - usdPrice
        - isNegotiable
        - sellerName
        - sellerPhone
        - stateCode
        - lga
        - address
        - images
        - thumbnailUrl
        - videoUrl
        - isDiasporaFriendly
        - acceptsUsd
        - acceptsGbp
        - hasDelivery
        - deliveryFee
      check: {}
      set:
        sellerId: X-Hasura-User-Id
        status: pending
  - role: admin
    permission:
      columns: "*"
      check: {}
update_permissions:
  - role: user
    permission:
      columns:
        - title
        - description
        - price
        - usdPrice
        - isNegotiable
        - stateCode
        - lga
        - address
        - images
        - thumbnailUrl
        - videoUrl
        - isDiasporaFriendly
        - acceptsUsd
        - acceptsGbp
        - hasDelivery
        - deliveryFee
      filter:
        sellerId:
          _eq: X-Hasura-User-Id
      check: {}
  - role: admin
    permission:
      columns: "*"
      filter: {}
      check: {}
delete_permissions:
  - role: user
    permission:
      filter:
        sellerId:
          _eq: X-Hasura-User-Id
  - role: admin
    permission:
      filter: {}
